publish-gitlab:
  stage: deploy
  image: python:3.10-bullseye
  tags:
    - build
  variables:
    FLIT_USERNAME: gitlab-ci-token
    FLIT_PASSWORD: ${CI_JOB_TOKEN}
    FLIT_INDEX_URL: ${CI_API_V4_URL}/projects/${CI_PROJECT_ID}/packages/pypi
  script:
    - pip install flit
    - flit publish --setup-py
  only:
    - main

publish-pypi:
  stage: deploy
  image: python:3.10-bullseye
  tags:
    - build
  variables:
    FLIT_USERNAME: __token__
    FLIT_PASSWORD: ${PYPI_TOKEN}
  script:
    - pip install flit
    - flit publish --setup-py
  only:
    - main
